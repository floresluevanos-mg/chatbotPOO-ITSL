<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TutorPOO ‚Äî Chatbot Educativo ¬∑ Clases y M√©todos</title>
<style>
  /* =====================================================
     VARIABLES Y RESET
     ===================================================== */
  :root {
    --bg: #f0f4ff;
    --surface: #ffffff;
    --surface2: #f7f9ff;
    --primary: #3a5bdb;
    --primary-light: #6681f5;
    --primary-dark: #2640b0;
    --accent: #ff6b35;
    --accent2: #00c896;
    --text: #1a1f36;
    --text-soft: #5a6380;
    --text-muted: #9098b5;
    --border: #dde3f8;
    --shadow: 0 4px 24px rgba(58,91,219,.10);
    --shadow-lg: 0 8px 40px rgba(58,91,219,.18);
    --radius: 18px;
    --radius-sm: 10px;
    --font-display: 'Georgia', 'Times New Roman', serif;
    --font-body: 'Segoe UI', system-ui, -apple-system, sans-serif;
    --font-code: 'Consolas', 'Courier New', monospace;
  }
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  html { font-size: 16px; scroll-behavior: smooth; }
  body {
    font-family: var(--font-body);
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    background-image:
      radial-gradient(circle at 20% 10%, rgba(102,129,245,.12) 0%, transparent 50%),
      radial-gradient(circle at 80% 90%, rgba(0,200,150,.08) 0%, transparent 50%);
  }

  /* =====================================================
     HEADER
     ===================================================== */
  .app-header {
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    padding: 0 24px;
    height: 64px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: 0 2px 12px rgba(58,91,219,.08);
  }
  .header-brand {
    display: flex;
    align-items: center;
    gap: 12px;
  }
  .header-logo {
    width: 40px; height: 40px;
    background: linear-gradient(135deg, var(--primary), var(--primary-light));
    border-radius: 12px;
    display: flex; align-items: center; justify-content: center;
    font-size: 20px;
    box-shadow: 0 4px 12px rgba(58,91,219,.25);
  }
  .header-title {
    font-family: var(--font-display);
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--primary);
    letter-spacing: -.02em;
  }
  .header-subtitle {
    font-size: .7rem;
    color: var(--text-muted);
    display: block;
    margin-top: 1px;
  }
  .header-teacher {
    font-size: .78rem;
    color: var(--text-soft);
    text-align: right;
    line-height: 1.4;
  }
  .header-teacher strong { color: var(--primary); font-size: .82rem; }

  /* =====================================================
     PROGRESS BAR
     ===================================================== */
  .progress-bar-wrap {
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    padding: 8px 24px 10px;
  }
  .progress-label {
    display: flex;
    justify-content: space-between;
    font-size: .72rem;
    color: var(--text-muted);
    margin-bottom: 5px;
  }
  .progress-track {
    background: var(--border);
    border-radius: 999px;
    height: 7px;
    overflow: hidden;
  }
  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--primary), var(--primary-light), var(--accent2));
    border-radius: 999px;
    transition: width .6s cubic-bezier(.4,0,.2,1);
    width: 0%;
  }
  .progress-steps {
    display: flex;
    gap: 6px;
    margin-top: 6px;
  }
  .step-dot {
    height: 4px;
    flex: 1;
    border-radius: 99px;
    background: var(--border);
    transition: background .4s;
  }
  .step-dot.active { background: var(--primary-light); }
  .step-dot.done { background: var(--accent2); }

  /* =====================================================
     LAYOUT PRINCIPAL
     ===================================================== */
  .app-layout {
    max-width: 900px;
    margin: 0 auto;
    padding: 24px 16px;
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  /* =====================================================
     SCREENS (pantallas)
     ===================================================== */
  .screen { display: none; animation: fadeIn .4s ease; }
  .screen.active { display: block; }
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  /* =====================================================
     PANTALLA 1: REGISTRO
     ===================================================== */
  .register-card {
    background: var(--surface);
    border-radius: var(--radius);
    padding: 40px 36px;
    box-shadow: var(--shadow-lg);
    max-width: 520px;
    margin: 0 auto;
    border: 1px solid var(--border);
  }
  .register-icon {
    font-size: 3rem;
    text-align: center;
    margin-bottom: 16px;
  }
  .register-title {
    font-family: var(--font-display);
    font-size: 1.7rem;
    color: var(--primary);
    text-align: center;
    margin-bottom: 6px;
  }
  .register-desc {
    text-align: center;
    color: var(--text-soft);
    font-size: .92rem;
    margin-bottom: 28px;
    line-height: 1.6;
  }
  .form-group {
    margin-bottom: 18px;
  }
  .form-group label {
    display: block;
    font-size: .82rem;
    font-weight: 600;
    color: var(--text);
    margin-bottom: 7px;
    letter-spacing: .01em;
  }
  .form-group input, .form-group select {
    width: 100%;
    padding: 11px 16px;
    border: 1.5px solid var(--border);
    border-radius: var(--radius-sm);
    font-family: var(--font-body);
    font-size: .95rem;
    color: var(--text);
    background: var(--surface2);
    transition: border-color .2s, box-shadow .2s;
    outline: none;
  }
  .form-group input:focus, .form-group select:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(58,91,219,.12);
    background: #fff;
  }
  .btn-primary {
    width: 100%;
    padding: 13px;
    background: linear-gradient(135deg, var(--primary), var(--primary-light));
    color: #fff;
    border: none;
    border-radius: var(--radius-sm);
    font-family: var(--font-body);
    font-size: 1rem;
    font-weight: 700;
    cursor: pointer;
    letter-spacing: .02em;
    transition: transform .15s, box-shadow .2s;
    box-shadow: 0 4px 16px rgba(58,91,219,.3);
  }
  .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 24px rgba(58,91,219,.4); }
  .btn-primary:active { transform: translateY(0); }
  .btn-secondary {
    padding: 9px 20px;
    background: var(--surface2);
    color: var(--primary);
    border: 1.5px solid var(--border);
    border-radius: var(--radius-sm);
    font-family: var(--font-body);
    font-size: .88rem;
    font-weight: 600;
    cursor: pointer;
    transition: background .2s, border-color .2s;
  }
  .btn-secondary:hover { background: var(--border); border-color: var(--primary-light); }

  /* =====================================================
     PANTALLA 2: CHATBOT
     ===================================================== */
  .chat-container {
    background: var(--surface);
    border-radius: var(--radius);
    box-shadow: var(--shadow-lg);
    border: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    height: calc(100vh - 200px);
    min-height: 500px;
    max-height: 680px;
    overflow: hidden;
  }
  .chat-header {
    padding: 16px 22px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    gap: 14px;
    background: linear-gradient(135deg, #f0f4ff, #f7f9ff);
  }
  .bot-avatar {
    width: 46px; height: 46px;
    background: linear-gradient(135deg, var(--primary), var(--primary-light));
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 22px;
    box-shadow: 0 3px 10px rgba(58,91,219,.25);
    flex-shrink: 0;
  }
  .bot-info h3 {
    font-size: 1rem;
    font-weight: 700;
    color: var(--primary);
  }
  .bot-info p {
    font-size: .75rem;
    color: var(--text-muted);
  }
  .chat-topic-badge {
    margin-left: auto;
    background: linear-gradient(135deg, var(--primary), var(--primary-light));
    color: #fff;
    font-size: .7rem;
    font-weight: 700;
    padding: 4px 12px;
    border-radius: 99px;
    letter-spacing: .04em;
  }
  .chat-messages {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 14px;
    scroll-behavior: smooth;
  }
  .chat-messages::-webkit-scrollbar { width: 6px; }
  .chat-messages::-webkit-scrollbar-thumb { background: var(--border); border-radius: 99px; }

  /* Burbujas de mensajes */
  .msg { display: flex; gap: 10px; max-width: 85%; animation: msgIn .3s ease; }
  @keyframes msgIn {
    from { opacity: 0; transform: translateY(6px); }
    to   { opacity: 1; transform: translateY(0); }
  }
  .msg.bot { align-self: flex-start; }
  .msg.user { align-self: flex-end; flex-direction: row-reverse; }
  .msg-avatar {
    width: 32px; height: 32px;
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 15px;
    flex-shrink: 0;
    margin-top: 2px;
  }
  .msg.bot .msg-avatar { background: linear-gradient(135deg, var(--primary), var(--primary-light)); }
  .msg.user .msg-avatar { background: linear-gradient(135deg, var(--accent), #ff9f70); }
  .msg-bubble {
    padding: 11px 16px;
    border-radius: 16px;
    font-size: .93rem;
    line-height: 1.6;
    word-break: break-word;
  }
  .msg.bot .msg-bubble {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-bottom-left-radius: 4px;
    color: var(--text);
  }
  .msg.user .msg-bubble {
    background: linear-gradient(135deg, var(--primary), var(--primary-light));
    color: #fff;
    border-bottom-right-radius: 4px;
  }
  .msg-bubble code {
    font-family: var(--font-code);
    background: rgba(58,91,219,.1);
    padding: 2px 6px;
    border-radius: 4px;
    font-size: .85rem;
    color: var(--primary);
  }
  .msg.user .msg-bubble code {
    background: rgba(255,255,255,.2);
    color: #fff;
  }
  .msg-bubble pre {
    background: #1a1f36;
    color: #c9d1f5;
    border-radius: 10px;
    padding: 14px 16px;
    font-family: var(--font-code);
    font-size: .8rem;
    overflow-x: auto;
    margin: 10px 0 4px;
    line-height: 1.7;
    border: 1px solid #2d3468;
  }
  .msg-bubble pre .kw { color: #7c98ff; }
  .msg-bubble pre .cl { color: #ffd080; }
  .msg-bubble pre .st { color: #80ffb4; }
  .msg-bubble pre .cm { color: #6b7ab5; font-style: italic; }
  .msg-bubble pre .nm { color: #ff9f70; }

  /* Botones de respuesta r√°pida */
  .quick-replies {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 10px;
  }
  .qr-btn {
    padding: 7px 16px;
    background: #fff;
    border: 1.5px solid var(--primary);
    color: var(--primary);
    border-radius: 99px;
    font-size: .84rem;
    font-weight: 600;
    cursor: pointer;
    transition: all .18s;
    font-family: var(--font-body);
  }
  .qr-btn:hover { background: var(--primary); color: #fff; }

  /* Input √°rea */
  .chat-input-area {
    padding: 14px 18px;
    border-top: 1px solid var(--border);
    display: flex;
    gap: 10px;
    align-items: flex-end;
    background: var(--surface2);
  }
  .chat-input {
    flex: 1;
    padding: 10px 16px;
    border: 1.5px solid var(--border);
    border-radius: 99px;
    font-family: var(--font-body);
    font-size: .93rem;
    outline: none;
    background: #fff;
    transition: border-color .2s, box-shadow .2s;
    resize: none;
  }
  .chat-input:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(58,91,219,.1); }
  .chat-send-btn {
    width: 42px; height: 42px;
    background: linear-gradient(135deg, var(--primary), var(--primary-light));
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    font-size: 18px;
    transition: transform .15s, box-shadow .2s;
    box-shadow: 0 3px 12px rgba(58,91,219,.3);
    flex-shrink: 0;
  }
  .chat-send-btn:hover { transform: scale(1.1); box-shadow: 0 5px 18px rgba(58,91,219,.45); }

  /* =====================================================
     PANTALLA 3: QUIZ
     ===================================================== */
  .quiz-card {
    background: var(--surface);
    border-radius: var(--radius);
    box-shadow: var(--shadow-lg);
    border: 1px solid var(--border);
    overflow: hidden;
  }
  .quiz-header {
    background: linear-gradient(135deg, var(--primary), var(--primary-light));
    padding: 22px 28px;
    color: #fff;
  }
  .quiz-header h2 {
    font-family: var(--font-display);
    font-size: 1.4rem;
    margin-bottom: 4px;
  }
  .quiz-header p { font-size: .85rem; opacity: .85; }
  .quiz-meta {
    display: flex;
    gap: 20px;
    margin-top: 12px;
    font-size: .8rem;
    opacity: .9;
  }
  .quiz-meta span { display: flex; align-items: center; gap: 5px; }
  .quiz-body { padding: 28px; }
  .question-number {
    font-size: .75rem;
    font-weight: 700;
    color: var(--text-muted);
    letter-spacing: .08em;
    text-transform: uppercase;
    margin-bottom: 10px;
  }
  .question-text {
    font-size: 1.08rem;
    font-weight: 600;
    color: var(--text);
    margin-bottom: 20px;
    line-height: 1.5;
  }
  .quiz-options {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  .quiz-option {
    padding: 13px 18px;
    border: 2px solid var(--border);
    border-radius: var(--radius-sm);
    cursor: pointer;
    font-size: .93rem;
    font-family: var(--font-body);
    background: var(--surface2);
    text-align: left;
    transition: all .18s;
    display: flex;
    align-items: center;
    gap: 12px;
  }
  .quiz-option:hover:not(:disabled) {
    border-color: var(--primary);
    background: rgba(58,91,219,.06);
    transform: translateX(4px);
  }
  .quiz-option.correct { border-color: var(--accent2); background: rgba(0,200,150,.1); color: #007a5e; font-weight: 600; }
  .quiz-option.incorrect { border-color: #ff4d6d; background: rgba(255,77,109,.08); color: #c0002a; }
  .quiz-option:disabled { cursor: not-allowed; }
  .option-letter {
    width: 26px; height: 26px;
    border-radius: 50%;
    background: var(--border);
    display: flex; align-items: center; justify-content: center;
    font-size: .78rem;
    font-weight: 700;
    flex-shrink: 0;
    transition: background .18s;
  }
  .quiz-option:hover:not(:disabled) .option-letter { background: var(--primary); color: #fff; }
  .quiz-option.correct .option-letter { background: var(--accent2); color: #fff; }
  .quiz-option.incorrect .option-letter { background: #ff4d6d; color: #fff; }
  .quiz-feedback {
    margin-top: 16px;
    padding: 12px 16px;
    border-radius: var(--radius-sm);
    font-size: .88rem;
    font-weight: 600;
    display: none;
    animation: fadeIn .3s ease;
  }
  .quiz-feedback.show { display: flex; gap: 10px; align-items: flex-start; }
  .quiz-feedback.correct-fb { background: rgba(0,200,150,.12); color: #007a5e; border: 1px solid rgba(0,200,150,.3); }
  .quiz-feedback.wrong-fb { background: rgba(255,77,109,.08); color: #c0002a; border: 1px solid rgba(255,77,109,.2); }
  .quiz-nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 22px;
    padding-top: 18px;
    border-top: 1px solid var(--border);
  }
  .score-badge {
    background: linear-gradient(135deg, var(--primary), var(--primary-light));
    color: #fff;
    padding: 6px 16px;
    border-radius: 99px;
    font-size: .82rem;
    font-weight: 700;
  }
  /* Resultado final quiz */
  .quiz-result {
    text-align: center;
    padding: 40px 28px;
  }
  .result-score-circle {
    width: 130px; height: 130px;
    border-radius: 50%;
    margin: 0 auto 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: relative;
    background: conic-gradient(var(--primary-light) 0%, var(--accent2) var(--pct, 0%), var(--border) var(--pct, 0%));
    padding: 8px;
  }
  .result-score-inner {
    width: 110px; height: 110px;
    border-radius: 50%;
    background: #fff;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
  }
  .result-score-num {
    font-family: var(--font-display);
    font-size: 2.2rem;
    font-weight: 700;
    color: var(--primary);
    line-height: 1;
  }
  .result-score-label { font-size: .72rem; color: var(--text-muted); }
  .result-title {
    font-family: var(--font-display);
    font-size: 1.6rem;
    color: var(--primary);
    margin-bottom: 8px;
  }
  .result-msg { color: var(--text-soft); font-size: .95rem; margin-bottom: 24px; line-height: 1.5; }

  /* =====================================================
     PANTALLA 4: ENCUESTA BUS-11
     ===================================================== */
  .survey-card {
    background: var(--surface);
    border-radius: var(--radius);
    box-shadow: var(--shadow-lg);
    border: 1px solid var(--border);
    overflow: hidden;
  }
  .survey-header {
    background: linear-gradient(135deg, #2640b0, var(--primary));
    padding: 22px 28px;
    color: #fff;
  }
  .survey-header h2 { font-family: var(--font-display); font-size: 1.4rem; margin-bottom: 4px; }
  .survey-header p { font-size: .85rem; opacity: .85; }
  .survey-body { padding: 28px; display: flex; flex-direction: column; gap: 22px; }
  .survey-item {}
  .survey-q {
    font-size: .93rem;
    color: var(--text);
    margin-bottom: 10px;
    line-height: 1.5;
  }
  .survey-q strong { color: var(--primary); }
  .likert-scale {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }
  .likert-labels {
    display: flex;
    justify-content: space-between;
    font-size: .68rem;
    color: var(--text-muted);
    margin-bottom: 5px;
  }
  .likert-btn {
    flex: 1;
    min-width: 40px;
    padding: 8px 4px;
    border: 2px solid var(--border);
    border-radius: var(--radius-sm);
    background: var(--surface2);
    cursor: pointer;
    font-size: .88rem;
    font-weight: 700;
    color: var(--text-soft);
    text-align: center;
    transition: all .18s;
    font-family: var(--font-body);
  }
  .likert-btn:hover { border-color: var(--primary); color: var(--primary); }
  .likert-btn.selected {
    background: linear-gradient(135deg, var(--primary), var(--primary-light));
    border-color: var(--primary);
    color: #fff;
    transform: scale(1.05);
    box-shadow: 0 3px 10px rgba(58,91,219,.3);
  }
  .survey-footer {
    padding: 20px 28px;
    border-top: 1px solid var(--border);
    background: var(--surface2);
    display: flex;
    flex-direction: column;
    gap: 14px;
  }

  /* =====================================================
     PANTALLA 5: RESULTADO FINAL
     ===================================================== */
  .final-card {
    background: var(--surface);
    border-radius: var(--radius);
    box-shadow: var(--shadow-lg);
    border: 1px solid var(--border);
    padding: 40px 36px;
    text-align: center;
    max-width: 600px;
    margin: 0 auto;
  }
  .final-trophy { font-size: 4rem; margin-bottom: 16px; }
  .final-title {
    font-family: var(--font-display);
    font-size: 2rem;
    color: var(--primary);
    margin-bottom: 8px;
  }
  .final-subtitle { color: var(--text-soft); margin-bottom: 28px; line-height: 1.6; }
  .final-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px;
    margin-bottom: 28px;
  }
  .final-stat {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 16px;
  }
  .final-stat-num {
    font-family: var(--font-display);
    font-size: 2rem;
    font-weight: 700;
    color: var(--primary);
  }
  .final-stat-label { font-size: .78rem; color: var(--text-muted); margin-top: 3px; }
  .final-cert {
    background: linear-gradient(135deg, #f0f4ff, #f7fff9);
    border: 2px dashed var(--primary-light);
    border-radius: var(--radius-sm);
    padding: 18px;
    margin-bottom: 24px;
    font-size: .88rem;
    color: var(--text-soft);
    line-height: 1.7;
  }
  .final-cert strong { color: var(--primary); }

  /* =====================================================
     TYPING INDICATOR
     ===================================================== */
  .typing-indicator {
    display: flex;
    gap: 5px;
    padding: 12px 16px;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 16px;
    border-bottom-left-radius: 4px;
    width: fit-content;
    align-self: flex-start;
  }
  .typing-dot {
    width: 7px; height: 7px;
    background: var(--primary-light);
    border-radius: 50%;
    animation: bounce 1.2s infinite;
  }
  .typing-dot:nth-child(2) { animation-delay: .2s; }
  .typing-dot:nth-child(3) { animation-delay: .4s; }
  @keyframes bounce {
    0%,60%,100% { transform: translateY(0); opacity: .5; }
    30% { transform: translateY(-6px); opacity: 1; }
  }

  /* =====================================================
     CHIPS / TAGS
     ===================================================== */
  .topic-chip {
    display: inline-block;
    background: rgba(58,91,219,.1);
    color: var(--primary);
    font-size: .73rem;
    font-weight: 700;
    padding: 3px 10px;
    border-radius: 99px;
    margin: 2px 2px 6px;
    letter-spacing: .03em;
  }

  /* =====================================================
     RESPONSIVE
     ===================================================== */
  @media (max-width: 600px) {
    .app-header { padding: 0 14px; }
    .header-teacher { display: none; }
    .register-card { padding: 26px 20px; }
    .final-grid { grid-template-columns: 1fr; }
    .chat-container { height: calc(100vh - 180px); }
    .app-layout { padding: 14px 10px; }
    .quiz-body, .survey-body { padding: 20px; }
  }

  /* Divider decorativo */
  .divider {
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--border), transparent);
    margin: 6px 0;
  }
  .error-msg { color: #e53e3e; font-size: .82rem; margin-top: 5px; }
</style>
</head>
<body>

<!-- ====================================================
     HEADER FIJO
     ==================================================== -->
<header class="app-header">
  <div class="header-brand">
    <div class="header-logo">üéì</div>
    <div>
      <div class="header-title">TutorPOO</div>
      <span class="header-subtitle">Programaci√≥n Orientada a Objetos ¬∑ Nivel Superior</span>
    </div>
  </div>
  <div class="header-teacher">
    <strong>Dra. Mar√≠a Guadalupe Flores Lu√©vanos</strong><br>
    Docente responsable
  </div>
</header>

<!-- BARRA DE PROGRESO -->
<div class="progress-bar-wrap" id="progressWrap">
  <div class="progress-label">
    <span id="progressLabelLeft">Inicio</span>
    <span id="progressLabelRight">0%</span>
  </div>
  <div class="progress-track">
    <div class="progress-fill" id="progressFill"></div>
  </div>
  <div class="progress-steps" id="progressSteps">
    <!-- se generan din√°micamente -->
  </div>
</div>

<!-- ====================================================
     CONTENIDO PRINCIPAL
     ==================================================== -->
<main class="app-layout">

  <!-- ‚îÄ‚îÄ PANTALLA 1: REGISTRO ‚îÄ‚îÄ -->
  <section class="screen active" id="screen-register">
    <div class="register-card">
      <div class="register-icon">üìã</div>
      <h1 class="register-title">Bienvenido/a al Tutor Virtual</h1>
      <p class="register-desc">
        Antes de comenzar, por favor ingresa tus datos acad√©micos.<br>
        Esta sesi√≥n cubrir√° <strong>Introducci√≥n a Clases y M√©todos en POO</strong>.
      </p>
      <div class="form-group">
        <label for="inp-nombre">üë§ Nombre completo</label>
        <input type="text" id="inp-nombre" placeholder="Ej. Ana Mart√≠nez L√≥pez">
        <div class="error-msg" id="err-nombre"></div>
      </div>
      <div class="form-group">
        <label for="inp-control">üî¢ N√∫mero de control</label>
        <input type="text" id="inp-control" placeholder="Ej. 22100001">
        <div class="error-msg" id="err-control"></div>
      </div>
      <div class="form-group">
        <label for="inp-grupo">üè´ Grupo</label>
        <input type="text" id="inp-grupo" placeholder="Ej. 3A-ISC">
        <div class="error-msg" id="err-grupo"></div>
      </div>
      <button class="btn-primary" onclick="startChat()">üöÄ Comenzar el aprendizaje</button>
    </div>
  </section>

  <!-- ‚îÄ‚îÄ PANTALLA 2: CHATBOT ‚îÄ‚îÄ -->
  <section class="screen" id="screen-chat">
    <div class="chat-container">
      <div class="chat-header">
        <div class="bot-avatar">ü§ñ</div>
        <div class="bot-info">
          <h3>ProfeBot ‚Äî Asistente POO</h3>
          <p>Respondiendo en tiempo real ¬∑ Modo tutor activo</p>
        </div>
        <div class="chat-topic-badge">POO ¬∑ C#</div>
      </div>
      <div class="chat-messages" id="chatMessages"></div>
      <div class="chat-input-area">
        <input type="text" class="chat-input" id="chatInput"
               placeholder="Escribe tu respuesta o pregunta‚Ä¶"
               onkeydown="if(event.key==='Enter')sendMessage()">
        <button class="chat-send-btn" onclick="sendMessage()" title="Enviar">‚û§</button>
      </div>
    </div>
  </section>

  <!-- ‚îÄ‚îÄ PANTALLA 3: QUIZ ‚îÄ‚îÄ -->
  <section class="screen" id="screen-quiz">
    <div class="quiz-card">
      <div class="quiz-header">
        <h2>üß† Quiz Gamificado ‚Äî POO</h2>
        <p>Responde las siguientes preguntas sobre lo aprendido. ¬°Cada punto cuenta!</p>
        <div class="quiz-meta">
          <span>‚ùì <span id="qNumLabel">Pregunta 1</span> de 10</span>
          <span>‚≠ê Puntos: <span id="qScoreLabel">0</span></span>
        </div>
      </div>
      <div class="quiz-body" id="quizBody"></div>
    </div>
  </section>

  <!-- ‚îÄ‚îÄ PANTALLA 4: ENCUESTA BUS-11 ‚îÄ‚îÄ -->
  <section class="screen" id="screen-survey">
    <div class="survey-card">
      <div class="survey-header">
        <h2>üìä Escala de Usabilidad ‚Äî BUS-11</h2>
        <p>Tu opini√≥n es muy importante para mejorar esta herramienta educativa.</p>
      </div>
      <div class="survey-body" id="surveyBody">
        <!-- generado din√°micamente -->
      </div>
      <div class="survey-footer">
        <div id="surveyError" class="error-msg" style="display:none">‚ö†Ô∏è Por favor responde todas las preguntas antes de continuar.</div>
        <button class="btn-primary" onclick="submitSurvey()">üì§ Enviar encuesta y ver resultados</button>
      </div>
    </div>
  </section>

  <!-- ‚îÄ‚îÄ PANTALLA 5: RESULTADO FINAL ‚îÄ‚îÄ -->
  <section class="screen" id="screen-final">
    <div class="final-card">
      <div class="final-trophy">üèÜ</div>
      <h2 class="final-title">¬°Sesi√≥n completada!</h2>
      <p class="final-subtitle" id="finalSubtitle"></p>
      <div class="final-cert" id="finalCert"></div>
      <div class="final-grid" id="finalGrid"></div>
      <p style="font-size:.82rem;color:var(--text-muted);line-height:1.6;">
        Docente: <strong>Dra. Mar√≠a Guadalupe Flores Lu√©vanos</strong><br>
        Materia: Programaci√≥n Orientada a Objetos ¬∑ TutorPOO v1.0
      </p>
    </div>
  </section>

</main>

<!-- ====================================================
     JAVASCRIPT ‚Äî L√ìGICA COMPLETA
     ==================================================== -->
<script>
/* ============================================================
   ESTADO GLOBAL DE LA APLICACI√ìN
   ============================================================ */
const APP = {
  student: { nombre: '', control: '', grupo: '' },
  chatStep: 0,         // paso actual del gui√≥n del chat
  quizIndex: 0,        // pregunta actual del quiz
  quizScore: 0,        // puntaje acumulado
  quizAnswered: false, // flag para evitar doble click
  surveyAnswers: {},   // respuestas BUS-11
  screens: ['register','chat','quiz','survey','final'],
  currentScreen: 0,
};

/* ============================================================
   PROGRESS BAR
   ============================================================ */
const STEPS = ['Registro','Aprendizaje','Quiz','Encuesta','Resultados'];

function initProgressBar() {
  const stepsEl = document.getElementById('progressSteps');
  stepsEl.innerHTML = '';
  STEPS.forEach((_, i) => {
    const d = document.createElement('div');
    d.className = 'step-dot';
    d.id = `step-dot-${i}`;
    stepsEl.appendChild(d);
  });
  updateProgress(0);
}

function updateProgress(screenIdx) {
  const pct = Math.round((screenIdx / (STEPS.length - 1)) * 100);
  document.getElementById('progressFill').style.width = pct + '%';
  document.getElementById('progressLabelLeft').textContent = STEPS[screenIdx];
  document.getElementById('progressLabelRight').textContent = pct + '%';
  STEPS.forEach((_, i) => {
    const d = document.getElementById(`step-dot-${i}`);
    if (i < screenIdx) d.className = 'step-dot done';
    else if (i === screenIdx) d.className = 'step-dot active';
    else d.className = 'step-dot';
  });
}

/* ============================================================
   NAVEGACI√ìN ENTRE PANTALLAS
   ============================================================ */
function goTo(name) {
  APP.screens.forEach(s => {
    document.getElementById(`screen-${s}`).classList.remove('active');
  });
  document.getElementById(`screen-${name}`).classList.add('active');
  APP.currentScreen = APP.screens.indexOf(name);
  updateProgress(APP.currentScreen);
  window.scrollTo(0, 0);
}

/* ============================================================
   PANTALLA 1 ‚Äî REGISTRO
   ============================================================ */
function startChat() {
  // Validaci√≥n simple
  let valid = true;
  ['nombre','control','grupo'].forEach(f => {
    const v = document.getElementById(`inp-${f}`).value.trim();
    const e = document.getElementById(`err-${f}`);
    if (!v) { e.textContent = 'Este campo es obligatorio.'; valid = false; }
    else e.textContent = '';
    APP.student[f] = v;
  });
  if (!valid) return;

  // Persistir en localStorage para la sesi√≥n
  localStorage.setItem('tutorpoo_student', JSON.stringify(APP.student));

  goTo('chat');
  initChat();
}

/* ============================================================
   PANTALLA 2 ‚Äî CHATBOT EDUCATIVO
   Gui√≥n conversacional con pasos secuenciales
   ============================================================ */

/* Definici√≥n del gui√≥n: cada paso es un objeto con:
   - type: 'bot' | 'question'
   - text: contenido del mensaje del bot
   - code: (opcional) bloque de c√≥digo a mostrar
   - replies: (para 'question') opciones de respuesta r√°pida
   - trigger: clave de la respuesta del usuario para avanzar
*/
const CHAT_SCRIPT = [
  // 0 ‚Äî Bienvenida personalizada
  {
    type: 'bot',
    text: () => `¬°Hola, <strong>${APP.student.nombre}</strong>! üëã Bienvenido/a al Tutor Virtual de <strong>Programaci√≥n Orientada a Objetos</strong>.<br><br>
    Soy <strong>ProfeBot</strong>, tu asistente de aprendizaje. En esta sesi√≥n exploraremos juntos uno de los fundamentos m√°s importantes de POO:<br><br>
    <span class="topic-chip">üì¶ Clases</span><span class="topic-chip">üîµ Objetos</span><span class="topic-chip">‚öôÔ∏è Atributos</span><span class="topic-chip">üîß M√©todos</span><span class="topic-chip">üèóÔ∏è Constructores</span><br><br>
    ¬øListo/a para comenzar?`,
    replies: ['¬°S√≠, empecemos! üöÄ','¬øC√≥mo funcionar√° la sesi√≥n?']
  },
  // 1 ‚Äî Concepto de Clase
  {
    type: 'bot',
    text: `¬°Perfecto! Vamos al primer concepto.<br><br>
    <strong>¬øQu√© es una Clase?</strong><br><br>
    Una <em>clase</em> es como un <strong>molde o plano de construcci√≥n</strong>. Define la estructura y el comportamiento que tendr√°n los objetos creados a partir de ella.<br><br>
    üìå <em>Analog√≠a:</em> Si piensas en un "molde de galletas", la clase es ese molde. Con √©l puedes crear muchas galletas (objetos) de la misma forma, pero cada una es independiente.<br><br>
    En <strong>C#</strong>, una clase se declara as√≠:`,
    code: `<span class="cm">// Declaraci√≥n de una clase en C#</span>
<span class="kw">public class</span> <span class="cl">Persona</span>
{
    <span class="cm">// Atributos y m√©todos van aqu√≠</span>
}`
  },
  // 2 ‚Äî Pregunta sobre Clase
  {
    type: 'question',
    text: '¬øPuedes decirme, con tus propias palabras, qu√© es una clase? No te preocupes si no es perfecto, ¬°el aprendizaje es un proceso! üòä',
    replies: ['Es un molde para crear objetos','No estoy seguro/a, ¬øpuedes repetir?','Es un tipo de variable especial']
  },
  // 3 ‚Äî Retroalimentaci√≥n + Atributos
  {
    type: 'bot',
    text: `¬°Muy bien! Las respuestas m√°s completas ser√≠an: <em>una clase es un molde o plantilla que define la estructura de los objetos</em>. üëç<br><br>
    Ahora hablemos de los <strong>Atributos</strong>.<br><br>
    Los <em>atributos</em> (tambi√©n llamados campos o propiedades) son las <strong>caracter√≠sticas o datos</strong> que describe a los objetos de esa clase.<br><br>
    üßë Por ejemplo, una persona tiene: nombre, edad, estatura. Esos ser√≠an sus atributos.<br><br>
    En C# se declaran dentro de la clase:`,
    code: `<span class="kw">public class</span> <span class="cl">Persona</span>
{
    <span class="cm">// Atributos de la clase</span>
    <span class="kw">public</span> <span class="nm">string</span> Nombre;
    <span class="kw">public</span> <span class="nm">int</span>    Edad;
    <span class="kw">public</span> <span class="nm">double</span> Estatura;
}`
  },
  // 4 ‚Äî Concepto de Objeto
  {
    type: 'bot',
    text: `Ahora viene algo muy importante: los <strong>Objetos</strong>. üîµ<br><br>
    Un <em>objeto</em> es una <strong>instancia concreta</strong> de una clase. Si la clase es el molde, el objeto es lo que se fabrica con ese molde.<br><br>
    Cada objeto tiene sus propios valores de atributos.<br><br>
    As√≠ se crea un objeto en C#:`,
    code: `<span class="cm">// Crear un objeto (instancia) de la clase Persona</span>
<span class="cl">Persona</span> <span class="nm">persona1</span> = <span class="kw">new</span> <span class="cl">Persona</span>();

<span class="cm">// Asignar valores a los atributos del objeto</span>
<span class="nm">persona1</span>.Nombre   = <span class="st">"Ana"</span>;
<span class="nm">persona1</span>.Edad      = <span class="nm">21</span>;
<span class="nm">persona1</span>.Estatura  = <span class="nm">1.65</span>;`
  },
  // 5 ‚Äî Pregunta sobre Objeto
  {
    type: 'question',
    text: '¬øCu√°l es la diferencia entre una clase y un objeto? ü§î',
    replies: ['La clase es el molde, el objeto es la instancia','Son lo mismo','El objeto define la estructura']
  },
  // 6 ‚Äî Retroalimentaci√≥n + M√©todos
  {
    type: 'bot',
    text: `¬°Exacto! <strong>La clase es el molde; el objeto es la instancia creada a partir de ese molde.</strong> üéâ<br><br>
    Sigamos con los <strong>M√©todos</strong>. üîß<br><br>
    Un <em>m√©todo</em> es una <strong>funci√≥n dentro de una clase</strong> que define el comportamiento o las acciones que puede realizar un objeto.<br><br>
    üí° Continuando con la persona: ella puede <em>saludar</em>, <em>caminar</em>, <em>presentarse</em>. Esas acciones son m√©todos.<br><br>
    Ejemplo en C#:`,
    code: `<span class="kw">public class</span> <span class="cl">Persona</span>
{
    <span class="kw">public</span> <span class="nm">string</span> Nombre;
    <span class="kw">public</span> <span class="nm">int</span>    Edad;

    <span class="cm">// M√©todo: define el comportamiento</span>
    <span class="kw">public void</span> <span class="nm">Presentarse</span>()
    {
        Console.WriteLine(<span class="st">"Hola, me llamo "</span> + Nombre +
                          <span class="st">" y tengo "</span> + Edad + <span class="st">" a√±os."</span>);
    }
}`
  },
  // 7 ‚Äî M√©todo con par√°metro y retorno
  {
    type: 'bot',
    text: `Los m√©todos tambi√©n pueden <strong>recibir par√°metros</strong> (datos de entrada) y <strong>retornar valores</strong>:<br><br>
    üëá Veamos un m√©todo que calcula si alguien es mayor de edad:`,
    code: `<span class="kw">public</span> <span class="nm">bool</span> <span class="nm">EsMayorDeEdad</span>()
{
    <span class="kw">return</span> Edad >= <span class="nm">18</span>;
}

<span class="cm">// Uso del m√©todo:</span>
<span class="kw">if</span> (<span class="nm">persona1</span>.EsMayorDeEdad())
{
    Console.WriteLine(<span class="st">"Es mayor de edad."</span>);
}`
  },
  // 8 ‚Äî Constructores
  {
    type: 'bot',
    text: `Y llegamos al √∫ltimo concepto de hoy: los <strong>Constructores</strong>. üèóÔ∏è<br><br>
    Un <em>constructor</em> es un <strong>m√©todo especial</strong> que se ejecuta autom√°ticamente cuando se crea un objeto. Su prop√≥sito es <em>inicializar</em> los atributos del objeto con valores iniciales.<br><br>
    ‚úÖ Caracter√≠sticas del constructor:<br>
    ‚Ä¢ Tiene el <strong>mismo nombre que la clase</strong><br>
    ‚Ä¢ <strong>No tiene tipo de retorno</strong><br>
    ‚Ä¢ Se llama autom√°ticamente con <code>new</code><br><br>
    Ejemplo completo:`,
    code: `<span class="kw">public class</span> <span class="cl">Persona</span>
{
    <span class="kw">public</span> <span class="nm">string</span> Nombre;
    <span class="kw">public</span> <span class="nm">int</span>    Edad;

    <span class="cm">// Constructor: inicializa el objeto</span>
    <span class="kw">public</span> <span class="cl">Persona</span>(<span class="nm">string</span> nombre, <span class="nm">int</span> edad)
    {
        Nombre = nombre;
        Edad   = edad;
    }

    <span class="kw">public void</span> <span class="nm">Presentarse</span>()
    {
        Console.WriteLine(<span class="st">"Hola, soy "</span> + Nombre);
    }
}

<span class="cm">// Crear objeto con constructor</span>
<span class="cl">Persona</span> <span class="nm">p</span> = <span class="kw">new</span> <span class="cl">Persona</span>(<span class="st">"Carlos"</span>, <span class="nm">22</span>);
<span class="nm">p</span>.Presentarse(); <span class="cm">// Hola, soy Carlos</span>`
  },
  // 9 ‚Äî Pregunta final de comprensi√≥n
  {
    type: 'question',
    text: '¬°Excelente progreso! üåü Antes de pasar al quiz, una √∫ltima pregunta: ¬øpara qu√© sirve el constructor en una clase?',
    replies: ['Para inicializar los atributos del objeto','Para declarar los m√©todos','Para crear la clase']
  },
  // 10 ‚Äî Cierre del chat
  {
    type: 'bot',
    text: `¬°Muy bien! Los constructores sirven para <strong>inicializar un objeto</strong> con valores cuando es creado. üéØ<br><br>
    Has completado el m√≥dulo de aprendizaje. Revisemos lo que aprendiste hoy:<br><br>
    üì¶ <strong>Clase:</strong> Molde que define estructura y comportamiento<br>
    üîµ <strong>Objeto:</strong> Instancia concreta de una clase<br>
    ‚öôÔ∏è <strong>Atributos:</strong> Datos o caracter√≠sticas del objeto<br>
    üîß <strong>M√©todos:</strong> Acciones o comportamientos del objeto<br>
    üèóÔ∏è <strong>Constructor:</strong> M√©todo especial para inicializar objetos<br><br>
    ¬°Ahora es momento de poner a prueba tu conocimiento con el <strong>Quiz POO</strong>! üß†`,
    replies: ['¬°Listo para el quiz! üéÆ','Quiero repasar algo primero']
  }
];

/* ---------- Renderizado del chat ---------- */
let chatQueue = [];   // cola de mensajes pendientes
let isBotTyping = false;

function initChat() {
  APP.chatStep = 0;
  document.getElementById('chatMessages').innerHTML = '';
  processStep(0);
}

function processStep(idx) {
  if (idx >= CHAT_SCRIPT.length) return;
  const step = CHAT_SCRIPT[idx];
  if (step.type === 'bot') {
    showTyping(true);
    // Simular tiempo de escritura
    setTimeout(() => {
      showTyping(false);
      addBotMessage(step.text, step.code, step.replies);
      // Si no hay replies, avanzar al siguiente paso autom√°ticamente
      if (!step.replies) {
        APP.chatStep = idx + 1;
        setTimeout(() => processStep(APP.chatStep), 800);
      } else {
        APP.chatStep = idx + 1; // Esperar reply del usuario
      }
    }, 900 + Math.random() * 400);
  } else if (step.type === 'question') {
    showTyping(true);
    setTimeout(() => {
      showTyping(false);
      addBotMessage(step.text, null, step.replies);
      APP.chatStep = idx + 1;
    }, 700);
  }
}

function addBotMessage(text, code, replies) {
  const msgs = document.getElementById('chatMessages');
  const wrapper = document.createElement('div');
  wrapper.className = 'msg bot';

  const avatar = `<div class="msg-avatar">ü§ñ</div>`;

  let codeHtml = '';
  if (code) {
    codeHtml = `<pre>${code}</pre>`;
  }

  let repliesHtml = '';
  if (replies) {
    repliesHtml = `<div class="quick-replies">`;
    replies.forEach(r => {
      repliesHtml += `<button class="qr-btn" onclick="handleReply('${r.replace(/'/g,"\\'")}',this)">${r}</button>`;
    });
    repliesHtml += `</div>`;
  }

  wrapper.innerHTML = `${avatar}
    <div class="msg-bubble">${typeof text === 'function' ? text() : text}${codeHtml}${repliesHtml}</div>`;
  msgs.appendChild(wrapper);
  msgs.scrollTop = msgs.scrollHeight;
}

function addUserMessage(text) {
  const msgs = document.getElementById('chatMessages');
  const wrapper = document.createElement('div');
  wrapper.className = 'msg user';
  wrapper.innerHTML = `<div class="msg-avatar">üë§</div>
    <div class="msg-bubble">${text}</div>`;
  msgs.appendChild(wrapper);
  msgs.scrollTop = msgs.scrollHeight;
}

function showTyping(show) {
  const msgs = document.getElementById('chatMessages');
  let indicator = document.getElementById('typingIndicator');
  if (show) {
    if (!indicator) {
      indicator = document.createElement('div');
      indicator.id = 'typingIndicator';
      indicator.className = 'typing-indicator';
      indicator.innerHTML = `<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>`;
      msgs.appendChild(indicator);
      msgs.scrollTop = msgs.scrollHeight;
    }
  } else {
    if (indicator) indicator.remove();
  }
}

function handleReply(text, btn) {
  // Deshabilitar todos los botones del grupo de respuestas del mismo mensaje
  const allBtns = btn.closest('.quick-replies').querySelectorAll('.qr-btn');
  allBtns.forEach(b => b.disabled = true);
  btn.style.background = 'var(--primary)';
  btn.style.color = '#fff';

  addUserMessage(text);

  // Verificar si es "repasar"
  if (text.toLowerCase().includes('repasar') || text.toLowerCase().includes('repetir') || text.toLowerCase().includes('repetir')) {
    showTyping(true);
    setTimeout(() => {
      showTyping(false);
      addBotMessage('¬°Claro! No hay problema. üòä Puedes releer los mensajes anteriores o dime qu√© concepto quieres que repasemos: Clase, Objeto, Atributos, M√©todos o Constructores.', null, ['Repasar Clase','Repasar M√©todos','Ya entend√≠, sigamos']);
    }, 600);
    return;
  }
  if (text === 'Repasar Clase') {
    APP.chatStep = 1;
    setTimeout(() => processStep(APP.chatStep - 1), 500);
    return;
  }
  if (text === 'Repasar M√©todos') {
    APP.chatStep = 6;
    setTimeout(() => processStep(APP.chatStep - 1), 500);
    return;
  }
  // Si llega al quiz
  if (text.includes('quiz') || APP.chatStep >= CHAT_SCRIPT.length) {
    setTimeout(() => startQuiz(), 600);
    return;
  }

  // Avanzar al siguiente paso del gui√≥n
  setTimeout(() => processStep(APP.chatStep), 600);
}

function sendMessage() {
  const input = document.getElementById('chatInput');
  const text = input.value.trim();
  if (!text) return;
  input.value = '';
  addUserMessage(text);

  // Respuesta gen√©rica del bot para mensajes libres
  showTyping(true);
  setTimeout(() => {
    showTyping(false);
    addBotMessage('Gracias por tu mensaje. üòä Para avanzar en la lecci√≥n, usa los botones de respuesta r√°pida o escribe "siguiente" para continuar.', null, ['Continuar con la lecci√≥n','Ir al quiz üéÆ']);
  }, 900);
}

/* ============================================================
   PANTALLA 3 ‚Äî QUIZ GAMIFICADO
   ============================================================ */
const QUIZ_QUESTIONS = [
  {
    q: '¬øQu√© es una clase en Programaci√≥n Orientada a Objetos?',
    opts: ['Un tipo de variable primitiva','Un molde o plantilla que define la estructura de los objetos','Una funci√≥n especial del programa','Un archivo de configuraci√≥n'],
    correct: 1,
    fb: 'Correcto. Una clase es un molde que define la estructura y comportamiento de los objetos creados a partir de ella.',
    fbWrong: 'No es correcto. Una clase es un molde o plantilla que define la estructura de los objetos.'
  },
  {
    q: '¬øCu√°l de los siguientes es un ejemplo de atributo en una clase "Autom√≥vil"?',
    opts: ['Arrancar()','Frenar()','Marca','Conducir()'],
    correct: 2,
    fb: '¬°Exacto! "Marca" es un dato/caracter√≠stica del autom√≥vil, por lo tanto es un atributo.',
    fbWrong: 'Incorrecto. Los atributos son las caracter√≠sticas o datos del objeto. "Marca" ser√≠a un atributo; las dem√°s opciones son m√©todos (acciones).'
  },
  {
    q: '¬øQu√© palabra clave se usa en C# para crear un nuevo objeto?',
    opts: ['create','object','new','instance'],
    correct: 2,
    fb: '¬°Correcto! En C# se usa la palabra clave `new` para instanciar un objeto.',
    fbWrong: 'Incorrecto. En C# la palabra clave para crear objetos es `new`. Ejemplo: Persona p = new Persona();'
  },
  {
    q: '¬øQu√© es un objeto en POO?',
    opts: ['Una copia exacta de la clase','Una instancia concreta creada a partir de una clase','El c√≥digo fuente del programa','Un m√©todo sin par√°metros'],
    correct: 1,
    fb: '¬°Perfecto! Un objeto es una instancia concreta de una clase, con sus propios valores de atributos.',
    fbWrong: 'Incorrecto. Un objeto es una instancia concreta creada a partir de una clase.'
  },
  {
    q: '¬øQu√© hace un m√©todo en una clase?',
    opts: ['Define los atributos del objeto','Declara el nombre de la clase','Define el comportamiento o las acciones del objeto','Crea la base de datos del programa'],
    correct: 2,
    fb: '¬°Muy bien! Los m√©todos definen el comportamiento o las acciones que puede realizar un objeto.',
    fbWrong: 'Incorrecto. Los m√©todos definen el comportamiento o acciones del objeto. Los atributos definen sus datos.'
  },
  {
    q: '¬øCu√°l es la caracter√≠stica principal de un constructor?',
    opts: ['Tiene tipo de retorno int','Se llama manualmente en cualquier momento','Tiene el mismo nombre que la clase y se ejecuta al crear el objeto','Solo puede tener un par√°metro'],
    correct: 2,
    fb: '¬°Correcto! El constructor tiene el mismo nombre que la clase y se ejecuta autom√°ticamente al crear un objeto con `new`.',
    fbWrong: 'Incorrecto. El constructor tiene el mismo nombre que la clase, no tiene tipo de retorno, y se ejecuta autom√°ticamente al instanciar el objeto.'
  },
  {
    q: 'En C#, dado el c√≥digo: `Persona p = new Persona("Luis", 25);` ¬øQu√© se est√° haciendo?',
    opts: ['Declarando una clase','Creando un objeto llamado p con el constructor','Definiendo un m√©todo est√°tico','Importando una librer√≠a'],
    correct: 1,
    fb: '¬°Exacto! Se est√° creando un objeto `p` de tipo `Persona`, usando el constructor que recibe nombre y edad.',
    fbWrong: 'Incorrecto. Se est√° creando (instanciando) un objeto llamado `p` de la clase `Persona`, pasando par√°metros al constructor.'
  },
  {
    q: '¬øCu√°ntos objetos se pueden crear a partir de una misma clase?',
    opts: ['Solo uno','Exactamente dos','Tantos como sean necesarios','Ninguno, solo se usa la clase directamente'],
    correct: 2,
    fb: '¬°Correcto! De una clase se pueden crear tantos objetos como sea necesario, cada uno con sus propios valores.',
    fbWrong: 'Incorrecto. De una misma clase se pueden crear tantos objetos como se necesiten.'
  },
  {
    q: 'Si una clase `C√≠rculo` tiene el atributo `Radio` y el m√©todo `CalcularArea()`, ¬øcu√°l es la funci√≥n de `Radio`?',
    opts: ['Es un m√©todo que calcula el radio','Es una caracter√≠stica/dato del c√≠rculo','Es el constructor de la clase','Es el nombre de la clase base'],
    correct: 1,
    fb: '¬°Muy bien! `Radio` es un atributo porque representa una caracter√≠stica o dato del objeto.',
    fbWrong: 'Incorrecto. `Radio` es un atributo (dato o caracter√≠stica). `CalcularArea()` ser√≠a el m√©todo (acci√≥n).'
  },
  {
    q: 'Completa: "Un constructor en C# tiene el _____ nombre que la clase y _____ tipo de retorno."',
    opts: ['diferente / tiene','mismo / no tiene','mismo / tiene siempre void','diferente / no tiene'],
    correct: 1,
    fb: '¬°Perfecto! El constructor tiene el MISMO nombre que la clase y NO tiene tipo de retorno.',
    fbWrong: 'Incorrecto. El constructor tiene el MISMO nombre que la clase y NO tiene tipo de retorno (ni siquiera void).'
  }
];

function startQuiz() {
  APP.quizIndex = 0;
  APP.quizScore = 0;
  APP.quizAnswered = false;
  goTo('quiz');
  renderQuizQuestion();
}

function renderQuizQuestion() {
  const q = QUIZ_QUESTIONS[APP.quizIndex];
  const body = document.getElementById('quizBody');
  document.getElementById('qNumLabel').textContent = `Pregunta ${APP.quizIndex + 1}`;
  document.getElementById('qScoreLabel').textContent = APP.quizScore;

  const letters = ['A','B','C','D'];
  let optsHtml = q.opts.map((opt, i) =>
    `<button class="quiz-option" onclick="selectAnswer(${i})" data-idx="${i}">
      <span class="option-letter">${letters[i]}</span> ${opt}
     </button>`
  ).join('');

  body.innerHTML = `
    <div class="question-number">PREGUNTA ${APP.quizIndex + 1} DE ${QUIZ_QUESTIONS.length}</div>
    <div class="question-text">${q.q}</div>
    <div class="quiz-options" id="quizOptions">${optsHtml}</div>
    <div class="quiz-feedback" id="quizFeedback"></div>
    <div class="quiz-nav">
      <div class="score-badge">‚≠ê ${APP.quizScore} pts</div>
      <button class="btn-primary" id="nextBtn" style="display:none;width:auto;padding:10px 24px;" onclick="nextQuestion()">
        ${APP.quizIndex < QUIZ_QUESTIONS.length - 1 ? 'Siguiente ‚û§' : 'Ver resultados üèÜ'}
      </button>
    </div>`;
  APP.quizAnswered = false;
}

function selectAnswer(idx) {
  if (APP.quizAnswered) return;
  APP.quizAnswered = true;

  const q = QUIZ_QUESTIONS[APP.quizIndex];
  const opts = document.querySelectorAll('.quiz-option');
  const feedback = document.getElementById('quizFeedback');

  opts.forEach(o => o.disabled = true);
  opts[idx].classList.add(idx === q.correct ? 'correct' : 'incorrect');
  if (idx !== q.correct) opts[q.correct].classList.add('correct');

  const isCorrect = idx === q.correct;
  if (isCorrect) APP.quizScore += 10;

  feedback.className = `quiz-feedback show ${isCorrect ? 'correct-fb' : 'wrong-fb'}`;
  feedback.innerHTML = `${isCorrect ? '‚úÖ' : '‚ùå'} <span>${isCorrect ? q.fb : q.fbWrong}</span>`;

  document.getElementById('qScoreLabel').textContent = APP.quizScore;
  document.getElementById('nextBtn').style.display = 'block';
}

function nextQuestion() {
  APP.quizIndex++;
  if (APP.quizIndex >= QUIZ_QUESTIONS.length) {
    showQuizResult();
  } else {
    renderQuizQuestion();
  }
}

function showQuizResult() {
  const pct = Math.round((APP.quizScore / (QUIZ_QUESTIONS.length * 10)) * 100);
  let msg = '', emoji = '';
  if (pct >= 90) { msg = '¬°Excelente! Dominas los fundamentos de POO. Est√°s listo/a para conceptos m√°s avanzados.'; emoji = 'üåü'; }
  else if (pct >= 70) { msg = '¬°Muy bien! Tienes una buena comprensi√≥n. Repasa algunos conceptos y estar√°s al 100%.'; emoji = 'üëç'; }
  else if (pct >= 50) { msg = 'Aprobado. Hay conceptos que necesitas reforzar. ¬°Vuelve a revisar el material!'; emoji = 'üìö'; }
  else { msg = 'Necesitas repasar el contenido. ¬°No te rindas! La pr√°ctica hace al maestro. üí™'; emoji = 'üîÑ'; }

  const body = document.getElementById('quizBody');
  body.innerHTML = `
    <div class="quiz-result">
      <div class="result-score-circle" style="--pct:${pct}%">
        <div class="result-score-inner">
          <div class="result-score-num">${APP.quizScore}</div>
          <div class="result-score-label">de 100 pts</div>
        </div>
      </div>
      <div class="result-title">${emoji} ${pct}% de aciertos</div>
      <div class="result-msg">${msg}</div>
      <button class="btn-primary" style="max-width:320px;margin:0 auto;" onclick="startSurvey()">
        üìä Continuar a la encuesta BUS-11
      </button>
    </div>`;
  // Guardar score
  localStorage.setItem('tutorpoo_quiz', JSON.stringify({ score: APP.quizScore, pct }));
}

/* ============================================================
   PANTALLA 4 ‚Äî ENCUESTA BUS-11
   ============================================================ */
const BUS11_QUESTIONS = [
  'El chatbot fue f√°cil de usar.',
  'Pude encontrar la informaci√≥n que necesitaba con facilidad.',
  'El chatbot respondi√≥ de manera clara y comprensible.',
  'El contenido presentado por el chatbot fue relevante para la materia.',
  'Estoy satisfecho/a con la experiencia de aprendizaje con el chatbot.',
  'El chatbot me ayud√≥ a comprender mejor los conceptos de POO.',
  'La navegaci√≥n e interacci√≥n con el chatbot fue intuitiva.',
  'El chatbot proporcion√≥ retroalimentaci√≥n √∫til ante mis respuestas.',
  'El dise√±o del chatbot es agradable visualmente.',
  'Recomendar√≠a el uso de este chatbot a otros estudiantes.',
  'En general, la calidad del chatbot como herramienta educativa es buena.'
];
const LIKERT_LABELS_TEXT = ['Totalmente en desacuerdo','En desacuerdo','Neutral','De acuerdo','Totalmente de acuerdo'];

function startSurvey() {
  goTo('survey');
  renderSurvey();
}

function renderSurvey() {
  const body = document.getElementById('surveyBody');
  body.innerHTML = '';
  BUS11_QUESTIONS.forEach((q, i) => {
    const div = document.createElement('div');
    div.className = 'survey-item';
    let btns = [1,2,3,4,5].map(v =>
      `<button class="likert-btn" data-q="${i}" data-val="${v}" onclick="selectLikert(${i},${v},this)">${v}</button>`
    ).join('');
    div.innerHTML = `
      <div class="survey-q"><strong>${i+1}.</strong> ${q}</div>
      <div class="likert-labels"><span>Totalmente en desacuerdo</span><span>Totalmente de acuerdo</span></div>
      <div class="likert-scale" id="likert-row-${i}">${btns}</div>`;
    body.appendChild(div);
    if (i < BUS11_QUESTIONS.length - 1) {
      const dvdr = document.createElement('div');
      dvdr.className = 'divider';
      body.appendChild(dvdr);
    }
  });
}

function selectLikert(qIdx, val, btn) {
  APP.surveyAnswers[qIdx] = val;
  const row = document.getElementById(`likert-row-${qIdx}`);
  row.querySelectorAll('.likert-btn').forEach(b => b.classList.remove('selected'));
  btn.classList.add('selected');
}

function submitSurvey() {
  // Validar que todas est√©n respondidas
  const missing = BUS11_QUESTIONS.some((_, i) => APP.surveyAnswers[i] === undefined);
  const errEl = document.getElementById('surveyError');
  if (missing) { errEl.style.display = 'block'; return; }
  errEl.style.display = 'none';

  // Calcular puntaje BUS-11
  const total = Object.values(APP.surveyAnswers).reduce((a,b) => a+b, 0);
  const avg = (total / BUS11_QUESTIONS.length).toFixed(2);
  localStorage.setItem('tutorpoo_survey', JSON.stringify({ total, avg, answers: APP.surveyAnswers }));

  showFinalResults(total, avg);
}

/* ============================================================
   PANTALLA 5 ‚Äî RESULTADO FINAL
   ============================================================ */
function showFinalResults(busTotal, busAvg) {
  goTo('final');

  const quizData = JSON.parse(localStorage.getItem('tutorpoo_quiz') || '{"score":0,"pct":0}');
  const student = JSON.parse(localStorage.getItem('tutorpoo_student') || '{}');

  document.getElementById('finalSubtitle').innerHTML =
    `¬°Felicidades, <strong>${student.nombre || APP.student.nombre}</strong>! Has completado exitosamente la sesi√≥n de aprendizaje sobre Introducci√≥n a Clases y M√©todos en POO.`;

  const now = new Date();
  document.getElementById('finalCert').innerHTML = `
    Este documento certifica que el/la estudiante <strong>${student.nombre}</strong>
    (No. de control: <strong>${student.control}</strong>, Grupo: <strong>${student.grupo}</strong>)
    complet√≥ el m√≥dulo <strong>"Introducci√≥n a Clases y M√©todos en POO"</strong>
    bajo la supervisi√≥n de la <strong>Dra. Mar√≠a Guadalupe Flores Lu√©vanos</strong>.<br>
    Fecha: ${now.toLocaleDateString('es-MX', {year:'numeric',month:'long',day:'numeric'})}`;

  let usabilityLabel = busAvg >= 4.5 ? 'Excelente üåü' : busAvg >= 3.5 ? 'Buena üëç' : busAvg >= 2.5 ? 'Regular ‚ö†Ô∏è' : 'Baja üîÑ';

  document.getElementById('finalGrid').innerHTML = `
    <div class="final-stat">
      <div class="final-stat-num">${quizData.score}<span style="font-size:1rem;color:var(--text-muted)">/100</span></div>
      <div class="final-stat-label">Puntaje Quiz POO</div>
    </div>
    <div class="final-stat">
      <div class="final-stat-num">${quizData.pct}<span style="font-size:1rem;color:var(--text-muted)">%</span></div>
      <div class="final-stat-label">Porcentaje de aciertos</div>
    </div>
    <div class="final-stat">
      <div class="final-stat-num">${busTotal}<span style="font-size:1rem;color:var(--text-muted)">/55</span></div>
      <div class="final-stat-label">Puntaje BUS-11 Total</div>
    </div>
    <div class="final-stat">
      <div class="final-stat-num">${busAvg}</div>
      <div class="final-stat-label">Promedio BUS-11 ¬∑ ${usabilityLabel}</div>
    </div>`;
}

/* ============================================================
   INICIALIZACI√ìN
   ============================================================ */
document.addEventListener('DOMContentLoaded', () => {
  initProgressBar();
});
</script>
</body>
</html>
